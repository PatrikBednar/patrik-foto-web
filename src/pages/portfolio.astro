---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import { Image } from 'astro:assets';
import '../styles/portfolio-style.css';

// 1. Hromadné načtení všech JPG obrázků z assets
// Načte všechny .jpg soubory ze složky src/assets/images
const images = import.meta.glob<{ default: ImageMetadata }>('../assets/images/*.jpg', { eager: true });

// Pomocná funkce pro získání fotky podle názvu
const getImage = (filename: string) => {
    // Sestavíme cestu k souboru
    const path = `../assets/images/${filename}.jpg`;
    
    // Ověříme, zda soubor existuje
    if (!images[path]) {
        console.error(`Obrázek nenalezen: ${path}`);
        throw new Error(`Obrázek "${filename}.jpg" nebyl nalezen ve složce src/assets/images/! Zkontroluj přesný název.`);
    }
    return images[path].default;
};

// 2. Data pro galerii
// 'filename' odpovídá názvu souboru ve složce src/assets/images (bez koncovky .jpg)
// Vidím, že soubory mají v názvu "_lightbox", tak jsem to zahrnul sem.
const portfolioItems = [
    { cat: 'svatby', filename: 'IMG_1404_lightbox', alt: 'Stužkáč foto' },
    { cat: 'svatby', filename: 'IMG_1442_lightbox', alt: 'Svatba foto' },
    { cat: 'svatby', filename: 'IMG_1458_lightbox', alt: 'Stužkáč foto' },
    { cat: 'svatby', filename: 'IMG_1499_lightbox', alt: 'Svatba foto - prstýnky' },
    { cat: 'udalosti', filename: 'IMG_1565_lightbox', alt: 'Události foto' },
    { cat: 'svatby', filename: 'IMG_1636_lightbox', alt: 'Stužkáč foto - přípitek' },
    { cat: 'stuzkace', filename: 'IMG_1699_lightbox', alt: 'Stužkáč foto - přípitek' },
    { cat: 'portret', filename: 'IMG_1713_lightbox', alt: 'Portrét foto' },
    { cat: 'stuzkace', filename: 'IMG_1979_lightbox', alt: 'Stužkáč foto' },
    { cat: 'stuzkace', filename: 'IMG_2143_lightbox', alt: 'Stužkáč foto' },
    { cat: 'stuzkace', filename: 'IMG_2304_lightbox', alt: 'Stužkáč foto' },
    { cat: 'portret', filename: 'IMG_2375_lightbox', alt: 'Portrét foto' },
    { cat: 'portret', filename: 'IMG_2705_lightbox', alt: 'Portrét foto' },
    //{ cat: 'portret', filename: 'IMG_2806_lightbox', alt: 'Portrét foto páru' },
    { cat: 'udalosti', filename: 'IMG_3089_lightbox', alt: 'Akce foto' },
    { cat: 'portret', filename: 'IMG_3097_lightbox', alt: 'Portrét foto' },
    { cat: 'portret', filename: 'IMG_2969', alt: 'Portrét foto' },
    { cat: 'udalosti', filename: 'IMG_3531_lightbox', alt: 'Akce foto - koncert' },
    { cat: 'udalosti', filename: 'IMG_3629_lightbox', alt: 'Akce foto - koncert' },
    { cat: 'udalosti', filename: 'IMG_4133_lightbox', alt: 'Akce foto - koncert' },
    { cat: 'stuzkace', filename: 'IMG_4335_lightbox', alt: 'Stužkáč foto - selfie' },
    { cat: 'stuzkace', filename: 'IMG_4370_lightbox', alt: 'Stužkáč foto - stužkování' },
    { cat: 'stuzkace', filename: 'IMG_4431_lightbox', alt: 'Stužkáč foto - stužkování' },
    { cat: 'stuzkace', filename: 'IMG_4715_lightbox', alt: 'Stužkáč foto - tanec' },
    { cat: 'stuzkace', filename: 'IMG_5049_lightbox', alt: 'Stužkáč foto - tanec' },
    { cat: 'stuzkace', filename: 'IMG_5079_lightbox', alt: 'Stužkáč foto' },
    { cat: 'stuzkace', filename: 'IMG_5083_lightbox', alt: 'Stužkáč foto - stužkování' },
    { cat: 'stuzkace', filename: 'IMG_5134_lightbox', alt: 'Stužkáč foto' },
    //{ cat: 'portret', filename: 'IMG_7081_lightbox', alt: 'Portrét foto' },
    { cat: 'stuzkace', filename: 'IMG_7636_lightbox', alt: 'Stužkáč foto - stužkování' },
    { cat: 'stuzkace', filename: 'IMG_8712_lightbox', alt: 'Stužkáč foto - stužkování' },
    { cat: 'stuzkace', filename: 'IMG_8767_lightbox', alt: 'Stužkáč foto - stužkování' },
    { cat: 'stuzkace', filename: 'IMG_8779_lightbox', alt: 'Stužkáč foto - stužkování' },
    //{ cat: 'sport', filename: 'IMG_9940_lightbox', alt: 'Sport foto' },
    { cat: 'sport', filename: 'IMG_3922_lightbox', alt: 'Sport foto' },
    { cat: 'sport', filename: 'IMG_0773-Enhanced-NR', alt: 'Sport foto' },
    { cat: 'sport', filename: 'IMG_3980', alt: 'Sport foto' },
    { cat: 'sport', filename: 'IMG_9940', alt: 'Sport foto' },
    { cat: 'wildlife', filename: 'IMG_0836_lightbox', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_0999_lightbox', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_1091_lightbox', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_1939_lightbox', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_3620_lightbox', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_5103_lightbox', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_8644_lightbox', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_7476-Enhanced-NR', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_3197-Enhanced-NR', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_0330-Enhanced-RD', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_0874', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: '_MG_1674', alt: 'Wildlife foto' },
    { cat: 'wildlife', filename: 'IMG_1560', alt: 'Wildlife foto' },
];
---

<Layout title="Portfolio - Patrik Bednář">
    <Navbar />

    <main class="portfolio-page-main">
        <section id="portfolio-gallery" class="page-section">
            <div class="container">
                <div class="portfolio-text">
                    <h2>Moje <span>Portfolio</span></h2>
                </div>

                <div class="filter-buttons-wrapper">
                    <div class="filter-buttons">
                        <a href="#vse" class="filter-btn active" data-filter="all">Vše</a>
                        <a href="#reportaz" class="filter-btn" data-filter="udalosti">Reportáž</a>
                        <a href="#stuzkace" class="filter-btn" data-filter="stuzkace">Stužkáče</a>                    
                        <a href="#portret" class="filter-btn" data-filter="portret">Portrét</a>
                        <a href="#sport" class="filter-btn" data-filter="sport">Sport</a>
                        <a href="#svatby" class="filter-btn" data-filter="svatby">Svatby</a>
                        <a href="#wildlife" class="filter-btn" data-filter="wildlife">Wildlife</a>
                    </div>
                </div>

                <div class="gallery-grid">
                    {portfolioItems.map((item) => {
                        // Tady si Astro sáhne pro konkrétní fotku
                        const imgData = getImage(item.filename); 
                        
                        return (
                            <div class="gallery-item" data-category={item.cat}>
                                {/* Odkaz vede na plnou velikost obrázku (imgData.src).
                                   Uvnitř je komponenta <Image>, která automaticky vygeneruje
                                   zmenšený a optimalizovaný náhled (width={600}).
                                */}
                                <a href={imgData.src} data-alt={item.alt}>
                                    <Image 
                                        src={imgData} 
                                        alt={item.alt} 
                                        width={600} 
                                        quality="80"
                                        class="gallery-img" 
                                    />
                                </a>
                            </div>
                        );
                    })}
                </div>

            </div>
        </section>
    </main>

    <Footer />

    <div id="lightbox" class="lightbox">
        <button class="lightbox-close" aria-label="Zavřít">&times;</button>
        <button class="lightbox-prev" aria-label="Předchozí obrázek">&lsaquo;</button>
        <button class="lightbox-next" aria-label="Další obrázek">&rsaquo;</button>
        <div class="lightbox-content-wrapper">
            <img src="" alt="" class="lightbox-img">
        </div>
        <div class="lightbox-toolbar">
            <span class="lightbox-counter"></span>
            <button class="lightbox-play" aria-label="Spustit prezentaci"><i class="fas fa-play"></i></button>
        </div>
    </div>

    <style>
        .gallery-grid {
            transition: opacity 0.5s ease-in-out;
            opacity: 1;
        }
        
        .gallery-grid.filtering {
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }

        .gallery-item {
            animation: none !important;
            transform: none !important;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const filterBtns = document.querySelectorAll('.filter-btn') as NodeListOf<HTMLElement>;
            const galleryGrid = document.querySelector('.gallery-grid') as HTMLElement;
            const galleryItems = document.querySelectorAll('.gallery-item') as NodeListOf<HTMLElement>;
            let filterTimeout: number | undefined;

            if (filterBtns.length > 0 && galleryGrid) {
                filterBtns.forEach(btn => {
                    const newBtn = btn.cloneNode(true) as HTMLElement;
                    btn.parentNode?.replaceChild(newBtn, btn);

                    newBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const target = e.currentTarget as HTMLElement;
                        
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        target.classList.add('active');
                        
                        const filterValue = target.getAttribute('data-filter');

                        galleryGrid.classList.add('filtering');

                        if (filterTimeout) clearTimeout(filterTimeout);

                        filterTimeout = window.setTimeout(() => {
                            galleryItems.forEach(item => {
                                if (filterValue === 'all' || item.getAttribute('data-category') === filterValue) {
                                    item.style.display = '';
                                } else {
                                    item.style.display = 'none';
                                }
                            });
                            
                            galleryGrid.classList.remove('filtering');
                        }, 200);
                    });
                });
            }
        });
    </script>
</Layout>